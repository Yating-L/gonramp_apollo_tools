<tool id="jbrowsehubtoapollo" name="JBrowseHub To Apollo" version="1.0.0">
    <description>
        This Galaxy tool is used to prepare your files to be ready for displaying on JBrowse with Apollo plugin
    </description>

    <requirements>
        <requirement type="package" version="3.0.3">apollo_api</requirement>
    </requirements>

    <stdio>
    </stdio>

    <command detect_errors="exit_code"><![CDATA[
        ## Dump the tool parameters into a JSON file 
        python $json_file parameters.json;
        python $__tool_directory__/jbrowsehubToApollo.py --data_json parameters.json -o $output
    ]]></command>
    <configfiles>
        <configfile name="json_file">
import json
import sys

file_path = sys.argv[1]
#set global data_parameter_dict = {}
#silent $data_parameter_dict.update({"jbrowse_hub": str($jbrowse_hub)})
#silent $data_parameter_dict.update({"species_name": str($species_name)})
#silent $data_parameter_dict.update({"apollo_host": str($apollo_host)})
#silent $data_parameter_dict.update({"user_email": str($__user_email__)})
#silent $data_parameter_dict.update({"tool_directory": str($__tool_directory__)})
#silent $data_parameter_dict.update({"extra_files_path": str($jbrowse_hub.extra_files_path)})
#if $apollo_users_settings.apollo_users_selector == "yes":
    #set apollo_user = {"firstname": str($apollo_users_settings.firstname), "lastname": str($apollo_users_settings.lastname), "password": str($apollo_users_settings.password), "user_email": str($apollo_users_settings.user_email)}
    $data_parameter_dict.update({"apollo_user": $apollo_user})
#end if 
#silent $data_parameter_dict.update({"debug_mode": str($advanced_options.debug_mode)})
with open(file_path, 'w') as f:
    json.dump($data_parameter_dict, f)
        </configfile>
    </configfiles>


    <inputs>
        <param 
                format="jbrowsehub" 
                type="data"
                name="jbrowse_hub" 
                label="JBrowse Hub created by JBrowse Archive Creator" 
        />
        <param
                name="species_name"
                type="text"
                size="30"
                value="unknown"
                label="Species name"
        />
        <param
                name="apollo_host"
                type="text"
                label="Apollo host"
        />
        <conditional name="apollo_users_settings">
            <param name="apollo_users_selector" type="select" label="Create or specify your Apollo account">
                <option value="no" selected="true">Use exist demo user account (will use your galaxy email address for apollo, password: gonramp) </option>
                <option value="yes">Create or use your own Apollo account</option>
            </param>
            <!-- TODO: Avoid redundancy here -->
            <when value="yes">
                <param
                    name="firstname"
                    type="text"
                    label="First Name"
                />
                <param
                    name="lastname"
                    type="text"
                    label="Last Name"
                />
                <param
                    name="user_email"
                    type="text"
                    label="Email Address"
                />
                <param
                    name="password"
                    type="text"
                    label="Password"
                />
            </when>
            <when value="no">
                <param name="default_user" type="hidden"
                       value="false">
                </param>
            </when>
        </conditional>
        <conditional name="advanced_options">
            <param name="advanced_options_selector" type="select" label="Advanced options">
                <option value="off" selected="true">Hide advanced options</option>
                <option value="on">Display advanced options</option>
            </param>
            <!-- TODO: Avoid redundancy here -->
            <when value="on">
                <param name="debug_mode" type="select" label="Activate debug mode"> 
                    <option value="false" selected="true">No</option>
                    <option value="true">Yes</option>
                    <help>
                        Use this option if you are a G-OnRamp developer
                    </help>
                </param>
            </when>
            <when value="off">
                <param name="debug_mode" type="hidden"
                       value="false">
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format="html" name="output" label="${tool.name}" />
    </outputs>

    <help>
        This Galaxy tool will load a jbrowse hub to Apollo instance for visualization and interactive annotation.
    </help>
    <citations>
    </citations>
</tool>